

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>urllib入门 &mdash; My_Study_Spider v0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=34cd777e"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="requests" href="requests.html" />
    <link rel="prev" title="&lt;no title&gt;" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            My_Study_Spider
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">基础篇</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">urllib入门</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">获取下网页源码</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">下载一个图片</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">利用有道翻译翻译</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">隐藏浏览器代理</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">避免防盗链问题</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">认证问题</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">使用浏览器代理</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="requests.html">requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E7%8C%AB%E7%9C%BCtop%E6%8A%93%E5%8F%96.html">猫眼top抓取</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E6%B5%8F%E8%A7%88%E5%99%A8%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/firefox%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8.html">firefox开发工具使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E6%B5%8F%E8%A7%88%E5%99%A8%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/chrome%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8.html">chrome开发工具使用</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">中级篇</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../%E4%B8%AD%E7%BA%A7%E7%AF%87/bs4.html">bs4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E4%B8%AD%E7%BA%A7%E7%AF%87/selinium.html">selinium</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">框架篇</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../%E6%A1%86%E6%9E%B6%E7%AF%87/pyspider/pyspider%E5%85%A5%E9%97%A8.html">pyspider入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E6%A1%86%E6%9E%B6%E7%AF%87/scrapy/scrapy%E5%85%A5%E9%97%A8.html">scrapy入门</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">分布式篇</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../%E5%88%86%E5%B8%83%E5%BC%8F%E7%AF%87/scrapy-redis.html">scrapy-redis</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">My_Study_Spider</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">&lt;no title&gt;</a></li>
      <li class="breadcrumb-item active">urllib入门</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/基础篇/req/urllib入门.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="urllib">
<h1>urllib入门<a class="headerlink" href="#urllib" title="Link to this heading"></a></h1>
<section id="id1">
<h2>获取下网页源码<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 导入python标准的urllib请求包</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://docs.scrapy.org/en/latest/&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c1"># 读取响应流并decode为utf-8的</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2>下载一个图片<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 导入python标准的urllib请求包</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://www.linuxpanda.tech/images/avatar.jpg&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">getCode</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="s2">&quot;sijia.png&quot;</span><span class="p">,</span><span class="s1">&#39;bw&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span> <span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>执行完毕会在当前目录下生成一个sijia.png图片，如下图。</p>
<img alt="../../_images/sijia.png" src="../../_images/sijia.png" />
</section>
<section id="id3">
<h2>利用有道翻译翻译<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<p>有道翻译，在做之前需要使用浏览器获取写基础的信息。</p>
<img alt="../../_images/youdao1.png" src="../../_images/youdao1.png" />
<img alt="../../_images/youdao2.png" src="../../_images/youdao2.png" />
<p>解析结果是json结果，推荐使用在线的json编辑器去获取结构信息</p>
<img alt="../../_images/youdao3.png" src="../../_images/youdao3.png" />
<p>代码如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 导入python标准的urllib请求包</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="c1"># 这个url是调试的时候抓取到的接口地址,主要调试得到的是translate_o的。这里需要修改下。</span>
<span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://fanyi.youdao.com/translate?smartresult=dict&amp;smartresult=rule&quot;</span>

<span class="c1"># 这个data信息是根据调试中的form data里面信息获取到的</span>
<span class="n">data</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;i&#39;</span><span class="p">:</span> <span class="s1">&#39;good boy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="s1">&#39;AUTO&#39;</span><span class="p">,</span>
    <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="s1">&#39;AUTO&#39;</span><span class="p">,</span>
    <span class="s1">&#39;smartresult&#39;</span><span class="p">:</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span>
    <span class="s1">&#39;client&#39;</span><span class="p">:</span> <span class="s1">&#39;fanyideskweb&#39;</span><span class="p">,</span>
    <span class="s1">&#39;salt&#39;</span><span class="p">:</span> <span class="s1">&#39;1532835301042&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sign&#39;</span><span class="p">:</span> <span class="s1">&#39;861dbcf1c6a959f3d0933003d0b8e81d&#39;</span><span class="p">,</span>
    <span class="s1">&#39;doctype&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;2.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;keyfrom&#39;</span><span class="p">:</span> <span class="s1">&#39;fanyi.web&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;FY_BY_CLICKBUTTION&#39;</span><span class="p">,</span>
    <span class="s1">&#39;typoResult&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span>
<span class="p">}</span>
<span class="n">data</span><span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># 读取响应流并decode为utf-8的</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">json_result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json_result</span><span class="p">[</span><span class="s1">&#39;translateResult&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tgt&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>现在有点引入了salt和sign会有一定有效期的。</p>
</div>
</section>
<section id="id4">
<h2>隐藏浏览器代理<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<p>默认使用urllib，我们的user-agent是Python-urllib/2.6这种类型的，如果服务器端拒绝这种代理来源的话，我们就无法获取到我们需要的数据了。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 添加head</span>
<span class="nv">headers</span><span class="o">={</span>
<span class="w">    </span><span class="s2">&quot;User-Agent&quot;</span>:<span class="w"> </span><span class="s2">&quot;Mozilla/5.0 (X11; U; Linux i686) Gecko/20071127 Firefox/2.0.0.11&quot;</span>
<span class="o">}</span>
<span class="nv">req</span><span class="o">=</span><span class="w"> </span>urllib.request.Request<span class="o">(</span>url,headers<span class="o">=</span>headers<span class="o">)</span>
<span class="c1"># 如果上面没有指定heads,也是可以使用Request.add_header(key, val)方法添加对应的head</span>
<span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>urllib.request.urlopen<span class="o">(</span>req<span class="o">)</span>
</pre></div>
</div>
</section>
<section id="id5">
<h2>避免防盗链问题<a class="headerlink" href="#id5" title="Link to this heading"></a></h2>
<p>有些网站对自己的图片资源有防盗链设置，你要下载他的图片，必须是通过他的网址跳转过去的， 直接下载是没法下载的。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">req</span><span class="o">=</span><span class="w"> </span>urllib.request.Request<span class="o">(</span>url,headers<span class="o">=</span>headers<span class="o">)</span>
req.add_header<span class="o">(</span><span class="s1">&#39;Referer&#39;</span>,<span class="w"> </span><span class="s1">&#39;http://www.python.org/&#39;</span><span class="o">)</span>
req.add_header<span class="o">(</span><span class="s1">&#39;User-Agent&#39;</span>,<span class="w"> </span><span class="s1">&#39;Mozilla/5.0 (X11; U; Linux i686) Gecko/20071127 Firefox/2.0.0.11&#39;</span><span class="o">)</span>
<span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>urllib.request.urlopen<span class="o">(</span>req<span class="o">)</span>
</pre></div>
</div>
</section>
<section id="id6">
<h2>认证问题<a class="headerlink" href="#id6" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="c1"># Create an OpenerDirector with support for Basic HTTP Authentication...</span>
<span class="n">auth_handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPBasicAuthHandler</span><span class="p">()</span>
<span class="n">auth_handler</span><span class="o">.</span><span class="n">add_password</span><span class="p">(</span><span class="n">realm</span><span class="o">=</span><span class="s1">&#39;PDQ Application&#39;</span><span class="p">,</span>
                        <span class="n">uri</span><span class="o">=</span><span class="s1">&#39;https://mahler:8092/site-updates.py&#39;</span><span class="p">,</span>
                        <span class="n">user</span><span class="o">=</span><span class="s1">&#39;klem&#39;</span><span class="p">,</span>
                        <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;kadidd!ehopper&#39;</span><span class="p">)</span>
<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">auth_handler</span><span class="p">)</span>
<span class="c1"># ...and install it globally so it can be used with urlopen.</span>
<span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">install_opener</span><span class="p">(</span><span class="n">opener</span><span class="p">)</span>
<span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;http://www.example.com/login.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>这里使用install_opener来安装一个opener,这样我们后续使用urlopen会自动使用这个opener的，如果我们又代理的需求，也是可以构造一个ProxyHandler的。</p>
</section>
<section id="id7">
<h2>使用浏览器代理<a class="headerlink" href="#id7" title="Link to this heading"></a></h2>
<p>通常情况下我们使用爬虫就是快速抓取特定的数据，对人家服务器的压力是巨大的，服务器可能会根据特定ip请求的次数来判定爬虫，然后进行封禁操作。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://www.ip.cn&quot;</span>
<span class="n">proxy_handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">({</span><span class="s2">&quot;http&quot;</span><span class="p">:</span><span class="s2">&quot;91.147.221.160:41766&quot;</span><span class="p">})</span>
<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">proxy_handler</span><span class="p">)</span>
<span class="n">opener</span><span class="o">.</span><span class="n">addheaders</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;User-agent&#39;</span><span class="p">,</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36&#39;</span><span class="p">)]</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</pre></div>
</div>
<p>具体的代理ip自行搜索。</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="requests.html" class="btn btn-neutral float-right" title="requests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, zhaojiedi1992@outlook.com.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>